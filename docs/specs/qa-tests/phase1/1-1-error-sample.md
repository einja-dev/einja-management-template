# QAテスト フェーズ1-1: エラー事例サンプル

## テスト対象タスク
- タスクID: 1.1.x
- タスク名: エラー事例のサンプル
- 実装日: YYYY-MM-DD

## 1. 画面テストのエラー事例

### テストシナリオ・実施結果（最終更新: YYYY-MM-DD）

| No | URL | 操作対象 | 操作セレクタ | 操作種別 | 期待値 | 結果 | 備考 |
|----|-----|---------|------------|---------|--------|------|------|
| 1 | http://localhost:3000 | - | - | navigate | ログイン画面が表示される | ✅ | - |
| 2 | - | メールアドレス入力欄 | [data-testid="email-input"] | type | test@example.comが入力される | ❌ | **エラー**: 要素が見つからない。セレクタが`[data-testid="email"]`に変更されている可能性 |
| 3 | - | パスワード入力欄 | [data-testid="password-input"] | type | パスワードが入力される | ⚠️ | 入力はできたが、入力後に自動でクリアされる不具合あり |
| 4 | - | ログインボタン | [data-testid="login-button"] | click | ボタンがクリックされる | ❌ | **エラー**: ボタンがdisabled状態。バリデーションエラーの可能性 |
| 5 | - | エラーメッセージ | [data-testid="error-message"] | evaluate | エラーが表示されない | ❌ | **想定外**: 「メールアドレスの形式が正しくありません」が表示。バリデーションロジックに問題 |
| 6 | - | ローディングスピナー | [data-testid="loading"] | evaluate | ローディング表示 | ⚠️ | 表示されるが、5秒以上消えない。タイムアウト処理が必要 |

### 全体ステータス: ❌ FAIL

#### 主な問題点
1. **セレクタ不一致**: data-testidが仕様と異なる
2. **バリデーションエラー**: 正しい入力でもエラーになる
3. **パフォーマンス問題**: ローディングが長すぎる

---

## 2. APIテストのエラー事例

### テストシナリオ・実施結果（最終更新: YYYY-MM-DD）

| No | エンドポイント | メソッド | ヘッダー | ボディ | 期待値 | 結果 | 備考 |
|----|-------------|---------|---------|--------|--------|------|------|
| 1 | /api/auth/login | POST | Content-Type: application/json | {"email":"test@example.com","password":"pass123"} | ステータス200、トークン返却 | ❌ | **エラー**: ステータス500「Internal Server Error」、DBConnection失敗の可能性 |
| 2 | /api/users/me | GET | Authorization: Bearer abc123 | - | ステータス200、ユーザー情報 | ❌ | **エラー**: ステータス401「Invalid token format」、トークン形式が不正 |
| 3 | /api/plans | GET | - | - | ステータス200、プラン一覧 | ⚠️ | ステータス200だが、返却データが空配列。シードデータが投入されていない可能性 |
| 4 | /api/plans | POST | Content-Type: application/json | {"name":"Basic","price":1000} | ステータス201、作成されたプラン | ❌ | **エラー**: ステータス400「Missing required field: currency」、必須フィールド不足 |
| 5 | /api/plans/999 | DELETE | Authorization: Bearer token | - | ステータス204 | ⚠️ | ステータス404「Plan not found」だが、これは正常動作。テストデータの問題 |

### 全体ステータス: ❌ FAIL

#### 主な問題点
1. **データベース接続**: DB接続エラーが頻発
2. **必須フィールド**: APIドキュメントと実装の不一致
3. **テストデータ**: シードデータが不完全

---

## 3. データベーステストのエラー事例

### テストシナリオ・実施結果（最終更新: YYYY-MM-DD）

| No | テスト内容 | コマンド | 期待値 | 結果 | 備考 |
|----|-----------|---------|--------|------|------|
| 1 | マイグレーション状態確認 | pnpm exec prisma migrate status | すべて適用済み | ❌ | **エラー**: 1件のマイグレーションが未適用「20250107_add_index」 |
| 2 | テーブル存在確認 | pnpm exec prisma db pull | SubscriptionPlanテーブルが存在 | ❌ | **エラー**: テーブルが存在しない。マイグレーション未実行 |
| 3 | 外部キー制約確認 | SQL実行 | 制約が機能する | ⚠️ | 制約は存在するが、カスケード削除が設定されていない |
| 4 | インデックス確認 | SHOW INDEX | インデックスが存在 | ❌ | **エラー**: user_idのインデックスが欠落、パフォーマンス問題の原因 |

### 全体ステータス: ❌ FAIL

#### 主な問題点
1. **マイグレーション未適用**: 最新のマイグレーションが実行されていない
2. **スキーマ不整合**: Prismaスキーマとデータベースの状態が一致しない
3. **パフォーマンス**: 必要なインデックスが不足

---

## エラー時の対応フロー

### 1. エラー分類
- **✅ PASS**: 期待通りに動作
- **❌ FAIL**: 明確なエラー、要修正
- **⚠️ PARTIAL**: 動作するが改善が必要

### 2. 備考欄の記載ルール
- **成功時**: パフォーマンス情報、気になる挙動など
- **失敗時**: エラーメッセージ、推定原因、影響範囲
- **部分的成功時**: 問題の詳細と回避策

### 3. エビデンス収集
- エラー画面のスクリーンショット
- コンソールログ
- ネットワークタブの情報
- エラースタックトレース

### 4. 報告と対応
- task-executerへの差し戻し
- 修正優先度の判定
- 回避策の検討